<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <!-- Stellt sicher, dass die Oberfläche auf mobilen Geräten korrekt skaliert wird -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>{% block title %}Audio Pi{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='vendor/simple.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    {% if current_user.is_authenticated %}
    <nav>
        <a href="{{ url_for('index') }}">Home</a>
        <a href="{{ url_for('logs') }}">Logs</a>
        <a href="{{ url_for('change_password') }}">Passwort ändern</a>
        <a href="{{ url_for('set_time') }}">Zeit/Datum</a>
        <form action="{{ url_for('update') }}" method="post" class="inline-form">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit" class="btn">Update</button>
        </form>
        <form action="{{ url_for('logout_route') }}" method="post" class="inline-form">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit" class="btn">Logout</button>
        </form>
    </nav>
    {% else %}
    {% if request.endpoint != 'login' %}
    <div class="guest-navigation">
        <p>Bitte melden Sie sich an, um alle Funktionen zu nutzen.</p>
        <a href="{{ url_for('login') }}" class="btn">Zum Login</a>
    </div>
    {% endif %}
    {% endif %}
    {% block flashes %}
        {% with messages = get_flashed_messages() %}
            {% if messages %}
            <ul class="flashes">
                {% for message in messages %}
                <li>{{ message }}</li>
                {% endfor %}
            </ul>
            {% endif %}
        {% endwith %}
    {% endblock %}
    <main class="dashboard-layout">
        {% block global_header %}
        <header class="dashboard-header">
            <h1 class="dashboard-title">{% block page_heading %}Audio Pi Websteuerung{% endblock %}</h1>
        </header>
        {% endblock %}
        {% block content %}{% endblock %}
    </main>
    <script>
    (function () {
        document.addEventListener('DOMContentLoaded', function () {
            var meta = document.querySelector('meta[name="csrf-token"]');
            if (!meta) {
                return;
            }
            var token = meta.getAttribute('content');
            if (!token) {
                return;
            }
            window.csrfToken = token;
            if (typeof window.fetch === 'function') {
                var originalFetch = window.fetch.bind(window);
                window.fetch = function (input, init) {
                    init = init || {};
                    var headers = init.headers;
                    if (typeof Headers !== 'undefined' && !(headers instanceof Headers)) {
                        headers = new Headers(headers || {});
                    } else if (!headers) {
                        headers = {};
                    }
                    if (headers instanceof Headers) {
                        if (!headers.has('X-CSRFToken')) {
                            headers.set('X-CSRFToken', token);
                        }
                    } else if (!('X-CSRFToken' in headers)) {
                        headers['X-CSRFToken'] = token;
                    }
                    init.headers = headers;
                    return originalFetch(input, init);
                };
            }
        });
    })();
    </script>
</body>
</html>
